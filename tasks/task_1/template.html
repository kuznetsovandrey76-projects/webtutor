<!DOCTYPE html>
		<html lang="en">
		<head>
			<meta charset="UTF-8">
			<title>Task_1</title>
			<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
			<style>	
				.search-block {
					width: 80%;
					margin: 0 auto;
					background: lightblue;
					border: 1px solid black;
					position: relative;
					z-index: 1;
					padding: 5px;
				}

				.org-block,
				.division-block,
				.collaborator-info {
					background: khaki;
					border: 1px solid black;
					position: absolute;
					top: 80px;	
					left: 160px;
					z-index: 5;
					width: 80%;
					padding: 5px;
				}
				.collaborator {
					cursor: pointer;
				}
				.result {
					width: 80%;
					margin: 10px auto;
					position: relative;
					z-index: 1;
					background: white;
				}
				.collaborator-info__table td{
					width: 40%;
				}
				.collaborator-id,
				#collaborator-info--id {
					display: none;
				}
				
				.collaborator-update-org,
				.collaborator-update-division {
					background: lightgreen;
					border: 1px solid black;
					position: absolute;
					top: 80px;	
					left: 160px;
					z-index: 20;
					width: 40%;
					padding: 5px;
				}
				.block {
					background: rgba(123, 123, 43, .3);
					position: absolute;
					width: 100%;
					height: 100%;
					z-index: 0;
					top: 0;
					left: 0;
				}

				/* ДОП */
			    #filter-table{
			        width: 100%;
			    }
			    #filter-table th{
			        background-color: #dadada;
			    }
			    #filter-table td, #filter-table th{
			        padding: 5px;
			        border-bottom: 1px solid #ccc;
			    }
			    th {
			    	cursor: pointer;
			    }
			</style>
		</head>
		<body>	

			<!-- SEARCH -->
			<div id="search-block" class="search-block">
				<table>
					<tr>
						<td><label for="fullname">ФИО:</label>	</td>
						<td><input class="input-field" id="fullname" type="text"></td>
					</tr>
					<tr>
						<td><label for="position">Должность:</label></td>
						<td><input class="input-field" id="position" type="text"></td>
					</tr>
					<tr id="search-block__org">
						<td><label for="org">Организация:</label></td>
						<td><input class="input-field" id="org-button" type="button" value="Выбрать"></td>
					</tr>
					<tr id="search-block__division">
						<td><label for="division">Подразделение:</label></td>
						<td><input class="input-field" id="division-button" type="button" value="Выбрать"></td>
					</tr>
					<tr>
						<td><button id="search">Найти</button></td>
						<td></td>
					</tr>
				</table>
			</div>
			<!-- ORG -->
			<div id="org-block" class="org-block">
				<div id="find-org-block">
				</div>
			</div>
			<!-- DIVISION -->
			<div id="division-block" class="division-block">	
				<div id="find-division-block">
				</div>		
			</div>
			<!-- RESULT -->
			<div id="result" class="result">
				<table id="filter-table">
				  <thead>				  	
				    <tr>
				        <th class="collaborator-id" data-type="number">id</th>
				        <th data-type="string">ФИО</th>
				        <th data-type="string">Должность</th>
				        <th data-type="string">Организация</th>
				        <th data-type="string">Подразделение</th>
				    </tr>
				  </thead>
				  <tbody id="tbody">
				  	
				  </tbody>
				</table>
			</div>
			<!-- MODAL -->
			<div id="collaborator-info" class="collaborator-info">
				<table class="collaborator-info__table">
					<tr>
						<td id="collaborator-info--id"></td>
					</tr>
					<tr>
						<td>Фамилия:</td>
						<td id="collaborator-info--lastname"></td>
						<td><button id="edit-collaborator-info--lastname">Редактировать</button></td>
					</tr>
					<tr>
						<td>Имя:</td>
						<td id="collaborator-info--firstname"></td>
						<td><button id="edit-collaborator-info--firstname">Редактировать</button></td>
					</tr>
					<tr>
						<td>Отчество:</td>
						<td id="collaborator-info--middlename"></td>
						<td><button id="edit-collaborator-info--middlename">Редактировать</button></td>
					</tr>
					<tr>
						<td>Должность:</td>
						<td id="collaborator-info--position"></td>
						<td><button id="edit-collaborator-info--position">Редактировать</button></td>
					</tr>
					<tr>
						<td>Организация:</td>
						<td id="collaborator-info--org"></td>
						<td><button id="edit-collaborator-info--org">Редактировать</button></td>
					</tr>
					<tr>
						<td>Подразделение:</td>
						<td id="collaborator-info--division"></td>
						<td><button id="edit-collaborator-info--division">Редактировать</button></td>
					</tr>
					<tr>
						<td><button id="collaborator-save">Сохранить</button></td>
						<td></td>
					</tr>
				</table>
			</div>
			<!-- MODAL select ORG -->
			<div id="collaborator-update-org" class="collaborator-update-org">
				<div id="select-collaborator-update-org">
				</div>
			</div>
			<!-- MODAL select DIVISION -->
			<div id="collaborator-update-division" class="collaborator-update-division">
				<div id="select-collaborator-update-division">
				</div>
			</div>
			<div id="block" class="block"></div>
			<script>
				$( document ).ready(function() {

					// Поиск результатов
					var search = function() {
						$('.table-data').remove()

				    	// Введенные значения
			    		var fullname = $('#fullname').val()
			    		var position = $('#position').val()
			    		var orgs = []
			    		$.each( $('[data-org-id]'), function(key, value) {
			    			orgs.push($(this).data('orgId'))
			    		})

			    		var divisions = []
			    		$.each( $('[data-division-id]'), function(key, value) {
			    			divisions.push($(this).data('divisionId'))
			    		})

				    	// Обращение к выборке
						$.ajax({
							type: "POST",
							url: "/pp/Ext/extjs_json_collection_data.html",
							dataType: "json",
							data: {
								collection_code: "rc_task_finally",
								parameters: "fullname=" + fullname + ";position=" + position +
											";org=" + orgs.toString() + ";division=" + divisions.toString()
							},
							success: function (data, textStatus, jqXHR) {

								// Прорисовка таблицы =====================
								for (elem in data.results) {
								    var tr = $('<tr></tr>')
								    tr.addClass('table-data')

								    for(var i = 0; i < 5; i++) {
								    	var td = $('<td></td>')

								    	if (i === 0) {
								    		td.addClass('collaborator-id')
								    		td.attr('id', data.results[elem].id )
								    		td.text(data.results[elem].id)

								    	} else if (i === 1) {
								    		td.addClass('collaborator')
								    		td.text(data.results[elem].fullname)
								    	} else if (i === 2) {
								    		td.text(data.results[elem].position)
								    	} else if (i === 3) {
								    		td.text(data.results[elem].org)
								    		td.attr("data-info-org-id", data.results[elem].org_id);

								    	} else if (i === 4) {
								    		td.text(data.results[elem].division)
								    	}		 			
								    	
								    	tr.append(td)
								    }		

						    		// $('#filter-table').append(tr)					
						    		$('#tbody').append(tr)					
								}
							}
						});

						// Обработка ajax
						setTimeout(collaborator, 200);
					}

					// Для удаленного действия
					remoteAction = function (actionObject) {
						try {
							if (remoteAction != undefined) {
								var returnObject = {};
								var soapRequestBody;
								var soapServerUrl = actionObject.url != undefined ? actionObject.url : '/remote_actions_wsdl.xml';
								var soapFormat = actionObject.format != undefined ? actionObject.format : 'json';

								soapRequestBody  = "<?xml version=\"1.0\" encoding=\"utf-8\"?>";
								soapRequestBody += "<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">";
								soapRequestBody += "<soap:Body>";
								soapRequestBody += "<" + actionObject.name + " xmlns=\"http://www.websoft.ru/\">";
								soapRequestBody += "<format>" + soapFormat + "</format>";
								if (actionObject.options != undefined) {
									for (var i = 0; i < actionObject.options.length; i++) {
										soapRequestBody += "<" + actionObject.options[i].name + ">" + actionObject.options[i].value + "</" + actionObject.options[i].name + ">";
									}
								}
								soapRequestBody += "</" + actionObject.name + ">";
								soapRequestBody += "</soap:Body>";
								soapRequestBody += "</soap:Envelope>";

								$.ajax({
									type: "POST",
									url: soapServerUrl,
									contentType: "text/xml",
									dataType: "xml",
									data: soapRequestBody,
									success: processSuccess,
									error: processError
								});

								function processSuccess (data, status, req) {
									if (status == "success") {
										var returnObject = {
											error: data.getElementsByTagName('error')[0].firstChild,
											type: data.getElementsByTagName('type')[0].firstChild,
											messageText: data.getElementsByTagName('messageText')[0].firstChild,
											result: data.getElementsByTagName('result')[0].firstChild
										};
										try{
											returnObject.error = returnObject.error.nodeValue;
										}
										catch(_ex){}
										try{
											returnObject.type = returnObject.type.nodeValue;
										}
										catch(_ex){}
										try{
											returnObject.messageText = returnObject.messageText.nodeValue;
										}
										catch(_ex){}
										try{
											returnObject.result = returnObject.result.nodeValue;
										}
										catch(_ex){}

										if (actionObject.callback_f != undefined) {
											actionObject.callback_f(returnObject);
										}

										return returnObject;
									}
									else {
										throw status;
									}
								}

								function processError(data, status, req) {
									throw req.responseText;
								}
							}
							else
							{
								throw '00'
							}
						}
						catch(_exeption) {
							returnObject = {error: 1, messageText: _exeption};
							if (typeof(actionObject.callback_f) != 'undefined') {
								actionObject.callback_f(returnObject);
							}
							return returnObject ;
						}
					};

					var old_position;

					function collaborator() {
						// Работа с элементами результатов ============================
						$('.collaborator').click(function() {
							$('#block').css({'z-index': 2});


							var select_item = $(this).context.parentNode.children;
							// Получаем id выбранного элемента
							var fullname = $(select_item[1]).text().split(' ');
							var user = {
								id: $(select_item[0]).text(),
								lastname: fullname[0],
								firstname: fullname[1],
								middlename: fullname[2],
								// Первоначальное значение позиции
								position: $(select_item[2]).text(),
								org: $(select_item[3]).text(),
								org_id: $(select_item[3]).data('infoOrgId'),
								division: $(select_item[4]).text()
							}

							// console.log($(select_item[3]).data('infoOrgId'))

							$('#collaborator-info').show()

							$('#collaborator-info--id').text(user.id)
							$('#collaborator-info--lastname').text(user.lastname)
							$('#collaborator-info--firstname').text(user.firstname)
							$('#collaborator-info--middlename').text(user.middlename)
							$('#collaborator-info--position').text(user.position)

							old_position = $('#collaborator-info--position').text(user.position)

							$('#collaborator-info--org').text(user.org)
							$('#collaborator-info--org').attr("data-info-org-id-2", user.org_id)
							$('#collaborator-info--division').text(user.division)
						});					

							

						
		    			$('#result').show()
					}

					// + EDIT FULLNAME 
					$.each(['lastname', 'firstname', 'middlename'], function(index, value) {
						$('#edit-collaborator-info--' + value + '').click(function() {
							var button_text = $('#edit-collaborator-info--' + value + '')
							var edit_items = $('#collaborator-info--' + value + '')
							if ( button_text.text() === 'Редактировать' ) {
								$(edit_items).html('<input type="text" value="' +$(edit_items).text() +'" id="update_' + value + '"></input>')
								$(button_text).text('ок')
							} else {
								$(button_text).text('Редактировать')
								$(edit_items).text($('#update_' + value + '').val())
							}
						});						
					})

					$('#edit-collaborator-info--position').click(function() {

						var button_text = $('#edit-collaborator-info--position')
						var edit_items = $('#collaborator-info--position')

						// Заполнение новой позиции
						if ( edit_items.text() === '' ) {
							// Если у сотрудника не указана должность, то поле доступно для редактирования только после заполнения фильтров организации и подразделения. 	
							if ($('#collaborator-info--org').text() === '' || $('#collaborator-info--division').text() === '') {
								alert('Выберите организацию и подразделение')
							} else {
							if ( button_text.text() === 'Редактировать' ) {
								$(edit_items).html('<input type="text" value="' +$(edit_items).text() +'" id="update_position"></input>')
								$(button_text).text('ок')
								old_position = ""
							} else {
								$(button_text).text('Редактировать')
								$(edit_items).text($('#update_position').val())
							}
							}
						// Изменение существующей позиции
						} else {
							if ( button_text.text() === 'Редактировать' ) {
								$(edit_items).html('<input type="text" value="' +$(edit_items).text() +'" id="update_position"></input>')
								$(button_text).text('ок')
								old_position = $(edit_items).text()
							} else {
								$(button_text).text('Редактировать')
								$(edit_items).text($('#update_position').val())
							}
						}

					});


					// РЕДАКТОР ОРГАНИЗАЦИИ
					$('#edit-collaborator-info--org').click(function() {
						$('#block').css({'z-index': 6});

						$('#collaborator-update-org').show()

						// Запускаем тот же выбор что и в поиске
						$.ajax({
							type: "POST",
							url: "/pp/Ext/extjs_json_collection_data.html",
							dataType: "json",
							data: {
								collection_code: "rc_task_finally_org",
								parameters: ''
							},
							success: function (data, textStatus, jqXHR) {


								// Обнуляем #select-collaborator-update-org
								$('#select-collaborator-update-org').text('')

								// Прорисовка блока выбора ОРГАНИЗАЦИЙ =====================
								var button = $('<button id="update-org-search">Выбрать</button>')
								button.click(function() {
									$('#block').css({'z-index': 2});
									// Заменяем текущую организацию
									// Очищаем подразделение
				    				var org_search_DOM = $(this).context.parentNode.children
				    				for (var i = 0, max = org_search_DOM.length; i < max; i++) {
				    					if (org_search_DOM[i].checked) {
				    						$('#collaborator-info--org').text(org_search_DOM[i].value)
				    					}
				    				}
									$('#collaborator-info--division').text('')
									$('#collaborator-update-org').hide()
								})

								for (elem in data.results) {
									var id = data.results[elem].id
									var name = data.results[elem].name
									var input = $('<input type="radio" name="org" value="' + name + '" id="select' + id + '" checked />')
									var label = $('<label for="select' + id + '">"' + name + '"</label><br>')

						    		$('#select-collaborator-update-org').append(input)					
						    		$('#select-collaborator-update-org').append(label)					
								}

								// После добавления всех radio
					    		$('#select-collaborator-update-org').append(button)	

							}
						});
					});
					// РЕДАКТОР ПОДРАЗДЕЛЕНИЙ
					$('#edit-collaborator-info--division').click(function() {
						$('#block').css({'z-index': 6});

						$('#collaborator-update-division').show()

						checked = $('#collaborator-info--org').data('info-org-id-2')

						$.ajax({
							type: "POST",
							url: "/pp/Ext/extjs_json_collection_data.html",
							dataType: "json",
							data: {
								collection_code: "rc_task_finally_division",
								parameters: 'checked=' + checked
							},
							success: function (data, textStatus, jqXHR) {

								console.log(data.results)
								// Обнуляем #select-collaborator-update-division
								$('#select-collaborator-update-division').text('')

								// Прорисовка блока выбора ОРГАНИЗАЦИЙ =====================
								var button = $('<button id="update-division-search">Выбрать</button>')
								button.click(function() {
									$('#block').css({'z-index': 2});
									// Заменяем текущую организацию
									// Очищаем подразделение
				    				var division_search_DOM = $(this).context.parentNode.children
				    				for (var i = 0, max = division_search_DOM.length; i < max; i++) {
				    					if (division_search_DOM[i].checked) {
				    						$('#collaborator-info--division').text(division_search_DOM[i].value)
				    					}
				    				}
									// $('#collaborator-info--division').text('')
									$('#collaborator-update-division').hide()
								})

								for (elem in data.results) {
									var id = data.results[elem].id
									var name = data.results[elem].name
									var input = $('<input type="radio" name="division" value="' + name + '" id="select' + id + '" checked />')
									var label = $('<label for="select' + id + '">"' + name + '"</label><br>')

						    		$('#select-collaborator-update-division').append(input)					
						    		$('#select-collaborator-update-division').append(label)					
								}

								// После добавления всех radio
					    		$('#select-collaborator-update-division').append(button)	
							}
						});
					});

					// Сохранение измененных данных
					$('#collaborator-save').click(function() {
						// Проверка заполнены ли все поля
						if ($('#collaborator-info--firstname').text() || $('#collaborator-info--lastname').text() || $('#collaborator-info--middlename').text() || $('#collaborator-info--position').text() || $('#collaborator-info--org').text() || $('#collaborator-info--division').text()) {
							alert('Заполните все поля')
						} else {							
							// Проверка все ли изменения подтверждены
							if ($('#edit-collaborator-info--lastname').text() === 'ок' || $('#edit-collaborator-info--firstname').text() === 'ок'|| $('#edit-collaborator-info--middlename').text() === 'ок' || $('#edit-collaborator-info--position').text() === 'ок') {
								alert('Подтвердите все изменения')
							} else {
								// ОБНОВЛЯЕМ ДАННЫЕ НА СЕРВЕРЕ 
								$('#block').css({'z-index': 0});
								$('#collaborator-info').hide()

								var info_arr = $(this).context.parentNode.parentNode.parentNode.children
								// [id, lastname, firstname, middlename, position, org, division, ...]

								var id = info_arr[0].textContent.replace( /\s/g, "")
								var lastname = info_arr[1].children[1].textContent
								var firstname = info_arr[2].children[1].textContent
								var middlename = info_arr[3].children[1].textContent
								var position = info_arr[4].children[1].textContent
								var org = info_arr[5].children[1].textContent
								var division = info_arr[6].children[1].textContent

								var fullname = lastname + ' ' + firstname + ' ' + middlename 

								// Если позицию не изменяли 
								if (old_position == undefined) {
									old_position = ""
								}

								// console.log(old_position)

								//работа с удаленным действием 
								regAction = {
									name : "re_task_finally_1", //код удаленного действия
									options: [{ name: "id", value: id },
											 { name: "lastname", value: lastname },
											 { name: "firstname", value: firstname },
											 { name: "middlename", value: middlename },
											 { name: "fullname", value: fullname },
											 // Нужна отправка старой позиции
											 { name: "old_position", value: old_position},
											 // Отправка новой позиции
											 { name: "position", value: position},
											 { name: "org", value: org},
											 { name: "division", value: division}
											 ],

									callback_f : function(_doc){
										// waitWindow.hide();
										if (_doc.error == 0)
										{
											// Обновляем таблицу
											return search();
										}
										else
										{
											alert(0)
										}
									}
								} 
								// пример коллбэка на ответ, его может не быть, 
								// _doc - возвращаемый объект, содержит поля error, type, messageText, result
								remoteAction(regAction);							
							}							
						}						
					});


					// Скрываем блоки выбора 
					$.each(['org-block', 'division-block', 'result', 'collaborator-info', 'collaborator-update-org', 'collaborator-update-division'], function(index, value) {
						$('#' + value).hide()
					});

		       		// ВЫБОРКИ ============================
		       		// Организации
				    $('#org-button').click(function() {
				    	$('#block').css({'z-index': 2});
						$.ajax({
							type: "POST",
							url: "/pp/Ext/extjs_json_collection_data.html",
							dataType: "json",
							data: {
								collection_code: "rc_task_finally_org",
								parameters: ''
							},
							success: function (data, textStatus, jqXHR) {

								$('#find-org-block').text('')

								// Проверяем какие элементы уже выбраны .checked-org
								var already_checked = []

								if ($('.checked-org').length) {
									$.each($('.checked-org'), function(key, value) {
										already_checked.push($(this).text().slice(0, -1))
									})
								} 

								// Прорисовка блока выбора ОРГАНИЗАЦИЙ =====================
								var button = $('<button id="org-search">Выбрать</button>')

								for (elem in data.results) {
									var id = data.results[elem].id
									var name = data.results[elem].name
									var input = $('<input type="checkbox" name="org" value="' + name + '" id="' + id + '" />')

									if (already_checked.indexOf(name) != -1) {
										input.prop('checked', true);								
									}

									var label = $('<label for="' + id + '">"' + name + '"</label><br>')

						    		$('#find-org-block').append(input)					
						    		$('#find-org-block').append(label)					
								}

								// После добавления всех checkbox
					    		$('#find-org-block').append(button)		
					    						

					    		$('#org-search').click(function() {	
				    				$('#block').css({'z-index': 0});

				    				// Очищаем выбранные подразделения
					    			$('.checked-division').remove()

				    				// Выбранные элементы
				    				var checked = []

				    				$.each($('[name="org"]'), function() {
				    					if ($(this).context.checked) {
											checked.push({
				    							id: $(this).context.id,
				    							name: $(this).context.value
				    						})
				    					}
				    				})

				    				// Массив из объектов выбранных элементов 
				    				// {id: "6537284716620812580", name: "Yandex"}

				    				// Если есть checked - прорисовываем
				    				if (checked.length > 0) {
				    					// Вставляем выбранные элементы после #search-block__org

				    					// Очищаем от старых значений
										$('.checked-org').remove()
				    					
				    					for (elem in checked) {
				    						var name = checked[elem].name
				    						var id = checked[elem].id
								    		var tr = $('<tr></tr>')
								    		var td = $('<td></td>')
								    		var button = $('<button class="remove_checked_org">X</button>')
								    		button.click(function() {

				    							// Очищаем выбранные подразделения
					    						$('.checked-division').remove()
								    			
								    			// Удаляем блок
								    			$(this).context.parentNode.parentNode.remove()
								    		})
								    		td.append(button)
								    		tr.addClass('checked-org')
								    		tr.append('<td data-org-id="' + id + '">' + name + '</td>')
								    		tr.append(td)
			    							$('#search-block__org').after(tr)			    						
				    					}
				    				}

				    				$('#org-block').hide()
					    		});
							}
						});

						setTimeout(function() {
			    			$('#org-block').show()
						}, 200);	
				    });

		       		// Подразделения
		    		$('#division-button').click(function() {
		    			 $('#block').css({'z-index': 2});

						var already_checked = []

			    		$.each( $('[data-org-id]'), function(key, value) {
			    			already_checked.push($(this).data('orgId'))
			    		})

						$.ajax({
							type: "POST",
							url: "/pp/Ext/extjs_json_collection_data.html",
							dataType: "json",
							data: {
								collection_code: "rc_task_finally_division",

								// Добавляем переменную checked в выборке
								parameters: 'checked=' + already_checked.toString()
							},
							success: function (data, textStatus, jqXHR) {

								// Обнуляем #find-division-block
								$('#find-division-block').text('')

								// Проверяем какие элементы уже выбраны .checked-division
								var already_checked = []


					    		$.each( $('[data-division-id]'), function(key, value) {
					    			already_checked.push($(this).data('divisionId'))
					    		})

								// Прорисовка блока выбора ОРГАНИЗАЦИЙ =====================
								var button = $('<button id="division-search">Выбрать</button>')

								for (elem in data.results) {
									var id = data.results[elem].id
									var name = data.results[elem].name
									var input = $('<input type="checkbox" name="division" value="' + name + '" id="' + id + '" />')
									if(already_checked.indexOf(id) != -1) {
										input.prop('checked', true);								
									}

									var label = $('<label for="' + id + '">"' + name + '"</label><br>')

						    		$('#find-division-block').append(input)					
						    		$('#find-division-block').append(label)					
								}

								// После добавления всех checkbox
					    		$('#find-division-block').append(button)					

					    		$('#division-search').click(function() {
					    		 		$('#block').css({'z-index': 0});	    				


					    				var checked = []
					    				// Получаем DOM структуру #division-search
					    				var division_search_DOM = $(this).context.parentNode.children
					    				for (var i = 0, max = division_search_DOM.length; i < max; i++) {
					    					if (division_search_DOM[i].checked) {
					    						checked.push({
					    							id: division_search_DOM[i].id,
					    							name: division_search_DOM[i].value
					    						})
					    					}
					    				}
					    				// Массив из объектов выбранных элементов 
					    				// {id: "6537284716620812580", name: "Yandex"}

					    				// Если есть checked - прорисовываем
					    				if (checked.length > 0) {
					    					// Вставляем выбранные элементы после #search-block__division

					    					// Очищаем от старых значений
											$('.checked-division').remove()
					    					
					    					for (elem in checked) {
					    						var id = checked[elem].id
					    						var name = checked[elem].name
									    		var tr = $('<tr></tr>')
									    		var td = $('<td></td>')
									    		var button = $('<button>X</button>')
									    		button.click(function() {
									    			// Удаляем блок
									    			$(this).context.parentNode.parentNode.remove()
									    		})
									    		td.append(button)
									    		tr.addClass('checked-division')
									    		tr.append('<td data-division-id="' + id + '">' + name + '</td>')
									    		tr.append(td)
				    							$('#search-block__division').after(tr)			    						
					    					}
					    				}

					    				$('#division-block').hide()
					    		});

							}
						});

						setTimeout(function() {
			    			$('#division-block').show()
						}, 200);	
				    });				

				    $('#search').click(search);
				});
			</script>
			<script>

			    // сортировка таблицы
			    var grid = document.getElementById('filter-table');

			    grid.onclick = function(e) {
			      if (e.target.tagName != 'TH') return;

			      // Если TH -- сортируем
			      sortGrid(e.target.cellIndex, e.target.getAttribute('data-type'));
			    };

			    function sortGrid(colNum, type) {
			      var tbody = grid.getElementsByTagName('tbody')[0];
			      console.log(tbody)
			      // Составить массив из TR
			      var rowsArray = [].slice.call(tbody.rows);
			      console.log(rowsArray)

			      // определить функцию сравнения, в зависимости от типа
			      var compare;

			      switch (type) {
			        case 'number':
			          compare = function(rowA, rowB) {
			            return rowA.cells[colNum].innerHTML - rowB.cells[colNum].innerHTML;
			          };
			          break;
			        case 'string':
			          compare = function(rowA, rowB) {
			          	console.log(1, rowA.cells[colNum].textContent)
			          	console.log(2, rowB.cells[colNum].textContent)
			            return rowA.cells[colNum].textContent > rowB.cells[colNum].textContent;
			          };
			          break;
			      }

			      // сортировать
			      rowsArray.sort(compare);

			      // Убрать tbody из большого DOM документа для лучшей производительности
			      grid.removeChild(tbody);

			      // добавить результат в нужном порядке в TBODY
			      // они автоматически будут убраны со старых мест и вставлены в правильном порядке
			      for (var i = 0; i < rowsArray.length; i++) {
			        tbody.appendChild(rowsArray[i]);
			      }

			      grid.appendChild(tbody);

			    }
			  </script>
		</body>
</html>